
/* Code automatically generated by Vult https://github.com/modlfo/vult */
#include "engine.h"

void Sinus_wav__ctx_type_2_init(Sinus_wav__ctx_type_2 &_output_){
   Sinus_wav__ctx_type_2 _ctx;
   _ctx.stepRatio = 0x0 /* 0.000000 */;
   _ctx.step = 0x0 /* 0.000000 */;
   _ctx.phase_base = 0x0 /* 0.000000 */;
   _ctx.phase = 0x0 /* 0.000000 */;
   _ctx.fs = 0x0 /* 0.000000 */;
   _ctx.freq = 0x0 /* 0.000000 */;
   Sinus_wav_default(_ctx);
   _output_ = _ctx;
   return ;
}

void Sinus_wav_setSamplerate(Sinus_wav__ctx_type_2 &_ctx, fix16_t newFs){
   if(newFs > 0x0 /* 0.000000 */){
      _ctx.fs = newFs;
      _ctx.stepRatio = fix_div(int_to_fix(Sinus_wav_getSize(_ctx)),_ctx.fs);
   }
   Sinus_wav_updateStep(_ctx);
}

void Engine__ctx_type_0_init(Engine__ctx_type_0 &_output_){
   Engine__ctx_type_0 _ctx;
   _ctx.modulatorRatio = 0x0 /* 0.000000 */;
   Sinus_wav__ctx_type_2_init(_ctx.modulator);
   _ctx.fs = 0x0 /* 0.000000 */;
   _ctx.carrier_half_phase = 0x0 /* 0.000000 */;
   _ctx.carrierRatio = 0x0 /* 0.000000 */;
   Sinus_wav__ctx_type_2_init(_ctx.carrier);
   Engine_default(_ctx);
   _output_ = _ctx;
   return ;
}

fix16_t Engine_process(Engine__ctx_type_0 &_ctx){
   fix16_t carrier_phase;
   carrier_phase = fix_mul(_ctx.carrier_half_phase,(0x10000 /* 1.000000 */ + Sinus_wav_process(_ctx.modulator)));
   Sinus_wav_setPhase(_ctx.carrier,carrier_phase);
   fix16_t c;
   c = Sinus_wav_process(_ctx.carrier);
   return c;
}

void Engine_default(Engine__ctx_type_0 &_ctx){
   Engine_setSamplerate(_ctx,0x2c1999 /* 44.100000 */);
   Engine_setCarrierRatio(_ctx,0x10000 /* 1.000000 */);
   Engine_setModulatorRatio(_ctx,0x20000 /* 2.000000 */);
   Engine_setModulatorLevel(_ctx,0x1999 /* 0.100000 */);
   Engine_setFrequency(_ctx,0x70a3 /* 0.440000 */);
}


